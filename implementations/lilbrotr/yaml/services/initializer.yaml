# ============================================================================
# Initializer Service Configuration
# ============================================================================
# Description: Bootstrap database and seed initial data
# Used by: src/services/initializer.py
# Priority: CRITICAL (must run before other services)
# ============================================================================

# Schema verification - what to check during initialization
verify:
  extensions: true       # Verify PostgreSQL extensions exist
  tables: true           # Verify database tables exist
  procedures: true       # Verify stored procedures exist
  views: true            # Verify database views exist

# Expected database schema elements
schema:
  extensions:
    - pgcrypto           # For hashing functions (digest)
    - btree_gin          # For GIN indexes on tagvalues array
  tables:
    - relays
    - events
    - events_relays
    - nip11
    - nip66
    - relay_metadata
    - service_state
  procedures:
    - insert_event
    - insert_relay
    - insert_relay_metadata
    - delete_orphan_events
    - delete_orphan_nip11
    - delete_orphan_nip66
  views:
    - relay_metadata_latest

# Seed relays configuration
# Note: Network type (clearnet/tor) is auto-detected from URL
# Note: Duplicate URLs are ignored by the database (ON CONFLICT DO NOTHING)
# Note: File paths are relative to the working directory:
#       - Docker: /app (so data/seed_relays.txt = /app/data/seed_relays.txt)
#       - Local: run from implementations/lilbrotr/
# Note: Batch size is controlled by Brotr's max_batch_size in brotr.yaml
seed:
  enabled: true                    # Enable relay seeding
  file_path: data/seed_relays.txt  # Path to seed file